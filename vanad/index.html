<!DOCTYPE html>
<html lang="en">
<html>
<head>
<!-- main 3 lines -->
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="author" content="">
<!--<link rel="icon" href="favicon.ico">-->

<title>Test D 01 Rainer Ressar</title>


<script src="https://code.jquery.com/jquery-3.1.1.slim.min.js" integrity="sha384-A7FZj7v+d/sdmMqp/nOQwliLvUsJfDHW+k9Omg/a/EheAdgtzNs3hpfag6Ed950n" crossorigin="anonymous"></script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>


<script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js" integrity="sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb" crossorigin="anonymous"></script>

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<script>window.jQuery || document.write('<script src="../../assets/js/vendor/jquery.min.js"><\/script>')</script>

<link href="bootstrap.min.css" rel="stylesheet">
<link href="style.css" rel="stylesheet">

<script>
$(function(){
//siia hakkame asju laduma
	var trainTyp, trainNumber, trainNum, trainDate, compUrl, x, y;
	var arr = [];



	$.get('https://rata.digitraffic.fi/api/v1/live-trains?station=SLO', function(trainsData) {
	//console.log('data');
	//console.log(trainsData);
		for (var i = 0 ; i <= trainsData.length-1; i++) {
			trainTyp=trainsData[i].trainType;
			trainNum = trainsData[i].trainNumber;
			var api='https://rata.digitraffic.fi/api/v1/compositions/';
			var depDate='?departure_date=';
			trainDate = trainsData[i].departureDate;
			compUrl=api+trainNum+depDate+trainDate;
			console.log(i);
			//console.log(trainsData[i].trainType);
			//console.log(trainsData[i].trainNumber);
			//x = $("<h1></h1>").text(trainTyp+" "+trainNum);
			//$("body").append(x);
			arr.push(trainTyp+" "+trainNum);
			
			$.get(compUrl, function(compData){
				//console.log(compData.journeySections);
				//var comp= compData.journeySections;
				for (j in compData.journeySections) {
				var locomotive = compData.journeySections[j].locomotives[j].locomotiveType ;
				var powerT = compData.journeySections[j].locomotives[j].powerType ;

				//mingisugune for tsükkel vagunite jaoks
				//var wagonType =  ;
				
				var vMax = compData.journeySections[j].totalLength+" kmh" ;
				var locoLength = compData.journeySections[j].maximumSpeed+" m" ;
				//y = $("<p></p>").text(locomotive+", "+powerT+", "+vMax+", "+locoLength);
				//$("body").append(y);
				arr.push(locomotive+" "+powerT+" "+vMax+" "+locoLength);
				};

				

				



				
			});

			
			
			/*$.when($.get(compUrl)).done(function(compData){
				console.log(i+"compData");
				console.log(compData.journeySections);
				y = $("<p></p>").text(compData.journeySections);
				$("body").append(y);
			});
			*/
			//rongi tüüp+ rongi number
			//var x = $("<h1></h1>").text(trainsData[i].trainType+" "+trainNum);
			//$("body").append(x);




		//for lõppeb
		};
		$("body").append(arr);
		console.log(arr);
	//get function lõppeb
	});


/*$.when(
$.getJSON('https://rata.digitraffic.fi/api/v1/live-trains?station=SLO'),
$.getJSON(compUrl)
).done(function(trainsData, compData) {



console.log("trainsData");
console.log(trainsData);

for (var i = 0 ; i <= trainsData.length-1; i++) {
console.log(i);
console.log(trainsData[i]);
};

console.log("compData");
console.log(compData);

//$.each([trainsData], function( i, item ){
//console.log(item[i].trainType);
});*/

// do something    
// contestMedia = [ "success", statusText, jqXHR ]
// contest = [ "success", statusText, jqXHR ]

// response data can be gotten with contest[2].responseText


//function lõppeb
});
</script>

</head>
<body>

<nav class="navbar navbar-toggleable-md navbar-inverse bg-inverse fixed-top">
<button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarsExampleDefault" aria-controls="navbarsExampleDefault" aria-expanded="false" aria-label="Toggle navigation">
<span class="navbar-toggler-icon"></span>
</button>
<a class="navbar-brand" href="#">Train Composition Viewer</a>

<div class="collapse navbar-collapse" id="navbarsExampleDefault">
<ul class="navbar-nav mr-auto">
<li class="nav-item active">
<a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
</li>
<li class="nav-item">
<a class="nav-link" href="#">Link</a>
</li>
<li class="nav-item">
<a class="nav-link disabled" href="#">Disabled</a>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href="http://example.com" id="dropdown01" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Dropdown</a>
<div class="dropdown-menu" aria-labelledby="dropdown01">
<a class="dropdown-item" href="#">Action</a>
<a class="dropdown-item" href="#">Another action</a>
<a class="dropdown-item" href="#">Something else here</a>
</div>
</li>
</ul>
<form class="form-inline my-2 my-lg-0">
<input class="form-control mr-sm-2" type="text" placeholder="Search">
<button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
</form>
</div>
</nav>
<div class="container">










</div>
</body>
</html>